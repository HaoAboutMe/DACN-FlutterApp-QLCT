You are working on a Flutter app called "Whales Spent" ‚Äî a personal finance tracker.
The app now supports multiple currencies (VND and USD), but currency switching is not applied consistently across the app.

---

### üß© Current problem
Currency switching works partially:
‚úÖ Some screens correctly switch between VND ‚Üî USD.
‚ùå The following screens or widgets still display amounts in VND or with wrong conversions:

1. Balance Overview (Homepage)
2. All Budget screen
3. Add Transaction, Add Loan, Edit Transaction, Edit Loan ‚Üí input still uses VND formatting
   (user inputs VND, but after saving it shows USD)
4. Loan List screen and Loan Detail screen
5. Statistics screen (bar chart still displays 0.x M instead of USD values)
6. Spending Prediction section
7. Add Budget, Budget List, Overall Budget Transaction, Budget Category Transaction

Additionally:
- The conversion currently uses a fixed rate of `1 USD = 25,000 VND`.
- This is wrong. It must use a **real-time exchange rate** fetched from a public API.
- The user should **never have to manually change this number**.

---

### üßæ Required behavior

#### 1. Real-time conversion
- Use `https://api.exchangerate.host/latest?base=VND&symbols=USD`
  to fetch the latest exchange rate dynamically.
- Store the latest rate in `SharedPreferences` with a timestamp.
- Reuse the cached rate for up to **12 hours** before fetching again.
- If the API fails, fallback to the last cached rate (don‚Äôt use hardcoded 25,000).

#### 2. Consistent display across all screens
- All money-related UI must use the unified formatter:
  ```dart
  CurrencyFormatter.formatAmount(double amount)
which should automatically:

Detect the selected currency (VND or USD)

Convert between currencies using the latest rate

Format with the correct locale and symbol

vi_VN ‚Üí "9.923.000 ƒë"

en_US ‚Üí "$397.00"

Replace any hardcoded call to formatVND() or manual "ƒë" suffix.

3. Input handling
When in USD mode, the input fields in Add Transaction / Add Loan / Add Budget
must show and parse USD properly.

Conversion logic:

If the selected currency is USD, the input and stored amount should reflect the USD value.

If the user switches back to VND, automatically convert using current exchange rate.

4. Charts and statistics
Update bar chart and spending charts to display amounts in the selected currency.

Ensure labels, tooltips, and total values respect the same formatter.

When in USD mode, avoid showing "0.x M" ‚Äî instead show correct values in dollars (e.g., "$45.00").

5. Data model
Keep all amounts stored in VND internally (for consistency).

Conversion to USD should only happen on display, using CurrencyFormatter.

6. Testing and verification
Switch from VND ‚Üí USD on Profile Screen:

All screens listed above must instantly refresh with correct converted values.

Ensure cached rate is updated after 12 hours or when app restarts with old cache.

No rounding error or crash if user switches multiple times quickly.

‚öôÔ∏è Implementation guidance
Update CurrencyFormatter to handle caching, fetching, and conversion.

Use a singleton or provider (e.g., CurrencyProvider) to trigger rebuild when currency changes.

Refactor UI widgets that still use hardcoded ‚Äúƒë‚Äù or formatVND.

Make sure AmountInputFormatter adapts its behavior based on the selected currency.

üîí Notes
Do not hardcode exchange rates.

Do not create a new markdown or documentation file.

Focus on fixing and testing the logic in the actual Dart source files.

Prioritize stability and UI consistency after switching currencies.